"use strict";(self.webpackChunkinsiderstodo=self.webpackChunkinsiderstodo||[]).push([[687],{68:(e,t,a)=>{a.r(t),a.d(t,{default:()=>g});var n=a(43),l=a(706),s=a(739),i=a(379),o=a(472),d=a(15);async function r(e){const t=(0,o.P)((0,o.rJ)(d.db,e),(0,o.My)("Id","desc"),(0,o.AB)(1));try{const e=await(0,o.GG)(t);if(e.empty)return null;return e.docs[0].data().Id}catch(a){return console.error("Error fetching the last document:",a),null}}const c=async e=>{const t=(0,o.P)((0,o.rJ)(d.db,"Todo"),(0,o._M)("Id","==",e.id)),a=await(0,o.GG)(t);a.empty?console.error("No document found with the specified Id.",a):a.forEach((async t=>{const a=t.ref;await(0,o.mZ)(a,{Title:e.title,Completed:e.completed})}))};var u=a(579);const b=e=>{let{id:t,title:a,completed:i,statusTable:r}=e;const b=(0,n.useRef)(null),[p,h]=(0,n.useState)(!1),[m,x]=(0,n.useState)(!1),f=(0,l.j)(),v=""===a,j="ADMIN"===r?()=>{x(!0),(async e=>{await(0,o.kd)((0,o.H9)(d.db,"Todo","Todo"+e))})(t).then((()=>{f(s.z.removeTodo(t))})).finally((()=>{x(!1)}))}:void 0;return(0,u.jsxs)("div",{className:"grid grid-cols-12 p-4 border border-black rounded-md",children:[(0,u.jsxs)("div",{className:"flex gap-2 col-span-11",children:[(0,u.jsx)("input",{type:"checkbox",checked:i,onChange:()=>{c({id:t,title:a,completed:!i}),f(s.z.editTodoStatus(t))},className:"size-6"}),(0,u.jsxs)("div",{className:"w-full",onDoubleClick:()=>h("ADMIN"===r),onMouseLeave:()=>p&&h(!1),children:[!p&&!v&&(0,u.jsx)("h3",{children:a}),(p||v)&&(0,u.jsx)("form",{onSubmit:e=>{if(e.preventDefault(),b.current){const e=b.current.value;c({id:t,title:e,completed:i}),f(s.z.editTodo({id:t,title:e}))}h(!1)},children:(0,u.jsx)("input",{type:"text",defaultValue:a,ref:b,className:"bg-transparent rounded-lg w-full outline-none border-2 size-full px-2"})})]})]}),(0,u.jsx)("div",{className:"block grid-cols-1",children:(0,u.jsx)("button",{className:"text-red-600 disabled:text-slate-400 uppercase",onClick:j,disabled:m,children:"Delete"})})]})},p=()=>{const e=(0,l.G)((e=>e.todos)),{activeTable:t}=(0,l.G)((e=>e.tables)),a=(0,l.j)(),[c,p]=(0,n.useState)(!1);(0,n.useEffect)((()=>{t&&(async e=>{const t=(0,o.P)((0,o.rJ)(d.db,"Todo"),(0,o._M)("TableId","==",e)),a=await(0,o.GG)(t);return a.empty?[]:a.docs.map((e=>(0,i.A)({id:e.id},e.data())))})(t.id).then((e=>{const t=[...e.map((e=>({id:e.Id,title:e.Title,tableId:e.TableId,completed:e.Completed})))];a(s.z.setTodos([...t]))}))}),[t]);const h=t&&"ADMIN"===t.status?()=>{t&&(p(!0),(async e=>{const t=(await r("Todo")||1)+1;return await(0,o.BN)((0,o.H9)(d.db,"Todo","Todo"+t),{Completed:!1,Title:"",TableId:e,Id:t}),{id:t,title:"",tableId:e,completed:!1}})(t.id).then((e=>{a(s.z.addTodo({id:e.id,title:e.title,completed:e.completed,tableId:t.id}))})).finally((()=>p(!1))))}:void 0;return t?(0,u.jsxs)("div",{className:"block border border-black h-full-height-with-paddings pt-5 overflow-y-auto px-3",children:[(0,u.jsx)("h1",{className:"text-6xl font-semibold text-center",children:null===t||void 0===t?void 0:t.title}),(0,u.jsx)("button",{className:"\n                block\n                p-4\n                bg-[#03001C]\n                text-white\n                rounded-lg\n                hover:bg-[#301E67]\n                transition \n                duration-300 \n                ease-in-out\n                mt-3\n                mx-auto\n                disabled:bg-slate-400\n            ",onClick:h,disabled:void 0===h||c,children:"Create a task"}),(0,u.jsx)("div",{className:"flex flex-col gap-4 mt-3",children:e.map((e=>(0,u.jsx)(b,{title:e.title,id:e.id,completed:e.completed,statusTable:(null===t||void 0===t?void 0:t.status)||"VIEW"},e.id)))})]}):(0,u.jsx)(u.Fragment,{})};var h=a(87);const m=e=>{let{id:t,title:a,active:s,status:i,openModal:r}=e;const c=(0,n.useRef)(null),[b,p]=(0,n.useState)(!1),[m,x]=(0,n.useState)(!1),f=(0,l.j)();return(0,u.jsxs)("li",{className:"\n        flex\n        justify-between\n        items-center\n        border-[#5B8FB9]\n        border \n        rounded-lg \n        p-2 \n        text-white \n        hover:bg-[#5B8FB9] \n        hover:cursor-pointer\n        transition \n        duration-300 \n        ease-in-out\n        ".concat(s?"bg-[#5B8FB9]":void 0,"\n    "),onClick:()=>f(h.D.setActiveTable(t)),onDoubleClick:"ADMIN"===i?()=>p(!0):void 0,onMouseLeave:()=>b&&p(!1),children:[!b&&(0,u.jsx)("p",{children:a}),b&&(0,u.jsx)("form",{onSubmit:e=>{if(e.preventDefault(),c.current){const e=c.current.value;(async e=>{const t=(0,o.P)((0,o.rJ)(d.db,"Table"),(0,o._M)("Id","==",e.id)),a=await(0,o.GG)(t);a.empty?console.error("No document found with the specified Id.",a):a.forEach((async t=>{const a=t.ref;await(0,o.mZ)(a,{Title:e.title,Status:e.status})}))})({id:t,status:i,title:e}).then((()=>{f(h.D.editTable({id:t,newTitle:e}))}))}p(!1)},children:(0,u.jsx)("input",{ref:c,className:"bg-transparent rounded-lg w-full outline-none border-2 size-full px-2",defaultValue:a})}),"ADMIN"===i&&(0,u.jsxs)("div",{className:"flex gap-2",children:[(0,u.jsx)("button",{className:"\n                    text-green-500\n                    hover:cursor-pointer\n                ",disabled:m,onClick:r,children:"GRANT"}),(0,u.jsx)("button",{className:"\n                    text-red-500\n                    hover:cursor-pointer\n                ",onClick:e=>{e.stopPropagation(),x(!0),(async e=>{await(0,o.kd)((0,o.H9)(d.db,"Table","Table"+e));const t=(0,o.P)((0,o.rJ)(d.db,"Todo"),(0,o._M)("TableId","==",e)),a=(0,o.P)((0,o.rJ)(d.db,"UserTable"),(0,o._M)("TableId","==",e)),n=await(0,o.GG)(t),l=await(0,o.GG)(a);if(!n.empty)for(const s of n.docs)await(0,o.kd)(s.ref);if(!l.empty)for(const s of l.docs)await(0,o.kd)(s.ref)})(t).then((()=>{f(h.D.removeTable(t))})).finally((()=>{x(!1)}))},disabled:m,children:"DEL"})]})]})};var x=a(950),f=a(899);const v=(0,f.Ik)().shape({email:(0,f.Yj)().email("\u041d\u0435 \u043a\u043e\u0440\u0435\u043a\u0442\u043d\u0430 E-mail").required("\u041f\u043e\u043b\u0435 \u043e\u0431\u043e\u0432'\u044f\u0437\u043a\u043e\u0432\u0435!")}),j=e=>{let{isOpen:t=!0,onClose:a}=e;const[s,c]=(0,n.useState)({value:"",errors:{}}),[b,p]=(0,n.useState)("ADMIN"),[h,m]=(0,n.useState)(!1),{activeTable:f}=(0,l.G)((e=>e.tables));return(0,x.createPortal)((0,u.jsx)("dialog",{open:t,className:"\n        fixed\n        z-50\n        top-0\n        left-0\n        \n        size-full\n        bg-[#a6aebf8f]\n    ",children:(0,u.jsxs)("div",{className:"\n            absolute \n            left-1/2 \n            top-1/2 \n            -translate-x-1/2 \n            -translate-y-1/2 \n            block w-[60%] \n            border-black \n            border p-6 \n            bg-white\n        ",children:[(0,u.jsxs)("div",{className:"flex justify-between items-center",children:[(0,u.jsx)("h1",{className:"font-bold text-4xl",children:"Grant permission"}),(0,u.jsx)("button",{onClick:a,className:"\n                        transition \n                        duration-300\n                        ease-in-out\n                        p-1\n                        hover:bg-red-400\n                        hover:text-white\n                    ",children:"CLOSE"})]}),(0,u.jsxs)("form",{className:"\n                flex\n                flex-col\n                gap-4\n                w-full\n                pt-4\n            ",onSubmit:e=>{e.preventDefault(),v.validate({email:s.value},{abortEarly:!1}).then((e=>{f&&(m(!0),(async(e,t,a)=>{const n=(0,o.P)((0,o.rJ)(d.db,"UserTable"),(0,o._M)("Email","==",t),(0,o._M)("TableId","==",e));if((await(0,o.GG)(n)).empty){const n=(await r("UserTable")||0)+1;await(0,o.BN)((0,o.H9)(d.db,"UserTable","UserTable"+n),{Id:n,Email:t,Status:a,TableId:e})}})(f.id,e.email,b).then((()=>{a()})).finally((()=>{m(!1)})))})).catch((e=>{const t={};e.inner.forEach((e=>{e.path&&(t[e.path]=e.errors)})),console.log(Object.values(t)),c((e=>(0,i.A)((0,i.A)({},e),{},{errors:t})))}))},children:[(0,u.jsx)("input",{type:"text",placeholder:"Write an email",className:"block border border-black px-4 py-2 w-full",value:s.value,onChange:e=>c((t=>(0,i.A)((0,i.A)({},t),{},{value:e.target.value})))}),s.errors&&Object.values(s.errors).map((e=>(0,u.jsx)("p",{className:"text-red-400",children:e.reduce(((e,t)=>e+t+"\n"),"")}))),(0,u.jsxs)("select",{name:"role",id:"role",className:"px-4 py-2 border border-black",value:b,onChange:e=>p(e.target.value),children:[(0,u.jsx)("option",{value:"ADMIN",children:"ADMIN"}),(0,u.jsx)("option",{value:"VIEW",children:"VIEWER"})]}),(0,u.jsx)("button",{className:"\n                        block\n                        bg-black\n                        text-white\n                        px-4\n                        py-2\n                        text-lg\n                        uppercase\n                        hover:bg-[#00000095]\n                        transition\n                        duration-300\n                        ease-in-out\n                    ",disabled:h,children:"Grant"})]})]})}),document.body)};var T=a(580);const N=()=>{const{activeTable:e,tables:t}=(0,l.G)((e=>e.tables)),{email:a}=(0,l.G)((e=>e.user)),s=(0,l.j)(),[c,b]=(0,n.useState)(!1);(0,n.useEffect)((()=>{!async function(){if(0===t.length&&a){const e=await(async e=>{const t=(0,o.P)((0,o.rJ)(d.db,"UserTable"),(0,o._M)("Email","==",e)),a=await(0,o.GG)(t);if(a.empty)return[];{const e=a.docs.map((async e=>{const t=e.data(),a=(0,o.P)((0,o.rJ)(d.db,"Table"),(0,o._M)("Id","==",t.TableId)),n=await(0,o.GG)(a);if(!n.empty){const e=n.docs.map((e=>(0,i.A)({},e.data())));return(0,i.A)((0,i.A)({},e[0]),{},{Status:t.Status})}return null})),t=[];for(const a of e)if(null!==a){const e=await a;t.push(e)}return t}})(a);e&&e.forEach((e=>{s(h.D.addTable({id:e.Id,title:e.Title,status:e.Status}))}))}}()}),[]);const[p,x]=(0,n.useState)(!1);return a?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)("ul",{className:"flex flex-col gap-4 px-4 pt-4 list-none",children:[t.map((t=>(0,u.jsx)(m,{active:e&&e.id===t.id,id:t.id,title:t.title,status:t.status,openModal:()=>b(!0)},t.id))),(0,u.jsx)("li",{className:"\n            border-[#5B8FB9]\n            border \n            rounded-lg \n            p-2 \n            text-white \n            hover:bg-[#5B8FB9] \n            hover:cursor-pointer\n            transition \n            duration-300 \n            ease-in-out\n        ",onClick:p?void 0:()=>{x(!0);(async(e,t)=>{const a=(await r("Table")||1)+1,n=(await r("UserTable")||0)+1;return await(0,o.BN)((0,o.H9)(d.db,"Table","Table"+a),{Id:a,Title:e}),await(0,o.BN)((0,o.H9)(d.db,"UserTable","UserTable"+n),{Id:n,Email:t,Status:"ADMIN",TableId:a}),{id:a,title:e}})("Table"+(t.length+1),a).then((e=>{x(!1),s(h.D.addTable({id:e.id,title:e.title,status:"ADMIN"}))}))},children:"\u0421\u0442\u0432\u043e\u0440\u0438\u0442\u0438 \u0442\u0430\u0431\u043b\u0438\u0446\u044e"})]}),(0,u.jsx)(j,{isOpen:c,onClose:()=>b(!1)})]}):(0,u.jsx)(T.C5,{to:"/auth/login"})},g=n.memo((()=>(0,u.jsx)("section",{className:"w-full min-h-full-height",children:(0,u.jsxs)("div",{className:"grid grid-cols-12 gap-x-4",children:[(0,u.jsxs)("div",{className:"sticky top-[64px] block col-span-4 bg-[#301E67] h-full-height",children:[(0,u.jsx)("h4",{className:"block pt-4 px-4 text-white",children:"\u0421\u043f\u0438\u0441\u043e\u043a \u0442\u0430\u0431\u043b\u0438\u0446\u044c"}),(0,u.jsx)(N,{})]}),(0,u.jsx)("div",{className:"col-span-8 p-4",children:(0,u.jsx)("div",{className:"block px-2",children:(0,u.jsx)(p,{})})})]})})))}}]);
//# sourceMappingURL=687.964fbbb7.chunk.js.map